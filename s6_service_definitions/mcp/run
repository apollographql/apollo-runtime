#!/command/with-contenv bash

# Set our working directory
cd /opt || exit

if [ -v "$MCP_ENABLE" ]; then
  ARGS=(--operations /config/operations)

  if [[ -v MCP_INTROSPECTION ]]; then
   ARGS+=(--introspection)
  fi

  if [[ -f /config/api_schema.graphql ]]; then
    ARGS+=(--schema /config/api_schema.graphql)
  fi

  if [[ -v "$MCP_UPLINK" ]]; then
    ARGS+=(--uplink)
  fi

  if [[ -v MCP_SSE ]]; then
    ARGS+=(--sse-address 0.0.0.0)
  else
    ARGS+=(--http-address 0.0.0.0)
  fi

  exec /opt/apollo-mcp-server "${ARGS[@]}"
else
  while true; do sleep 10000; done
fi

